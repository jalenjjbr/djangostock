{% extends 'base.html' %}



{% block content %}

<h1>Tickets Currently for Sale</h1>

</br>

<h5>Click "Buy ticket" below to be connected via email with the seller.</h5>

</br>

<input type="text" id="searchTicketInput" onkeyup="searchTicket()" placeholder="Search for an event..." title="Type in the name of an event">

<table class="table table-striped table-bordered table-hover" id="ticketTable">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Event Name</th>
        <th scope="col">Date</th>
        <th scope="col">Location</th>
        <th scope="col">Asking Price</th>
        <th scope="col">Posted by</th>
        <th scope="col">Buy?</th>
      </tr>
    </thead>
    <tbody>

        {% for item in ticker %}
            <tr>
                <td scope="row">{{item}}</td>
                <td>{{item.date}}</td>
                <td>{{item.location}}</td>
                <td>{{item.price}}</td>
                <td>{{item.user_whole_name}}</td>
                {% if user.is_authenticated %}
                <td> <a href="{% url 'delete' item.id %}">Buy Ticket</a> </td>
                {% else %}
                <td> <a href="{% url 'login' %}">Buy Ticket</a> </td>
                {% endif %}
            </tr>
        {% endfor %}
     
    </tbody>
  </table>
  
</br>
</br>


{% if user.is_authenticated %}

  {% for field in form %}
  {% for error in field.errors %}
    <p style="color: red">{{ error }}</p>
  {% endfor %}
  {% endfor %}

<p>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseAddForm" aria-expanded="false" aria-controls="collapseAddForm">
    Add a ticket for sale
  </button>
</p>
<div class="collapse" id="collapseAddForm">
  <div class="float-left card card-body">
  <div class="float-left login-form"> 
    <form action="{% url 'add_stock' %}" class="form my-2 my-lg-0" method="POST">
        {% csrf_token %}
      <h5 class="text-center">Tell us about the ticket you're selling</h5>

      <div class="form-group"><input class="form-control mr-sm-2" type="search" placeholder="Event Name" aria-label="Search" name="tickerlong"></div>
      <div class="form-group"><input class="form-control mr-sm-2" type="date" placeholder="Date" aria-label="Search" name="date"></div>
      <div class="form-group"><input class="form-control mr-sm-2" type="text" placeholder="Location" aria-label="Search" name="location"></div>
      <div class="form-group"><input class="form-control mr-sm-2" type="number" placeholder="Asking Price" aria-label="Search" name="price"></div>
      <div class="form-group"><input type="hidden" name="user_whole_name" value="{{ user.get_full_name }}"></div>
      <div class="form-group"><input type="hidden" name="seller_email" value="{{ user.email }}"></div>
      <div class="form-group"><button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Post Ticket</button>
    </form>
  </div>
</div>
</div>
{% else %}
  </br>
  <span>Please <a href="{% url 'login' %}">log in</a> to post a ticket for sale.</span>
{% endif %}

<script>
  function searchTicket() {
    // Declare variables
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("searchTicketInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("ticketTable");
    tr = table.getElementsByTagName("tr");
  
    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[0];
      if (td) {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
  </script>


{% endblock %}